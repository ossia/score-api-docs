<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.17"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>score: Graphics plug-ins</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" href="http://ossia.io">score </a>
                </div>
                <ul class="nav navbar-nav">
                  <li class="active"><a href="index.html">Home</a></li>
                  <li><a href="classes.html">Classes</a></li>
                  <li><a href="namespaces.html">Namespaces</a></li>
                  <li><a href="files.html">Files</a></li>
                </ul>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_gfx_plugins.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Graphics plug-ins </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This section covers creating custom visual effect processes and nodes. See <a class="el" href="namespacescore_1_1gfx.html" title="Graphics rendering pipeline for ossia score.">score::gfx</a> and <a class="el" href="namespace_gfx.html" title="Binds the rendering pipeline to ossia processes.">Gfx</a> namespace documentation beforehand.</p>
<h1><a class="anchor" id="CustomNode"></a>
Creating a custom node</h1>
<p>To create a custom node, one must inherit from <a class="el" href="classscore_1_1gfx_1_1_node.html" title="Root data model for visual nodes.">score::gfx::Node</a> and <a class="el" href="classscore_1_1gfx_1_1_node_renderer.html" title="Renderer for a given node.">score::gfx::NodeRenderer</a>. A good example is <a class="el" href="structscore_1_1gfx_1_1_texgen_node.html">score::gfx::TexgenNode</a> which generates a texture on the CPU from a C++ function.</p>
<p>The process is as follows :</p>
<ul>
<li>Define the material of the node in a struct:</li>
</ul>
<div class="fragment"><div class="line">â €</div>
</div><!-- fragment --><div class="fragment"><div class="line">packed_struct MyShaderParameters {</div>
<div class="line">   <span class="keywordtype">int</span> <a class="code" href="classfoo.html">foo</a>;</div>
<div class="line">   <span class="keywordtype">float</span> bar[2];</div>
<div class="line">} my_params;</div>
<div class="line">end_packed_struct</div>
</div><!-- fragment --><p>The struct must respect GLSL std140 rules; helper macros are defined in &lt;ossia/detail/packed_struct.hpp&gt; (they are not sufficient ! sometimes additional padding is needed).</p>
<ul>
<li>Add matching ports in the constructor:</li>
</ul>
<div class="fragment"><div class="line">input.push_back(<span class="keyword">new</span> Port{<span class="keyword">this</span>, &amp;my_params.foo, Types::Int, {}});</div>
<div class="line">input.push_back(<span class="keyword">new</span> Port{<span class="keyword">this</span>, my_params.bar, Types::Vec2, {}});</div>
<div class="line">input.push_back(<span class="keyword">new</span> Port{<span class="keyword">this</span>, {}, Types::Image, {}});</div>
<div class="line">output.push_back(<span class="keyword">new</span> Port{<span class="keyword">this</span>, {}, Types::Image, {}});</div>
</div><!-- fragment --><ul>
<li>Write the shaders for your node (see ShaderConventions).</li>
</ul>
<p>For instance, for the above definition, the material_t UBO would look like this:</p>
<div class="fragment"><div class="line">layout(std140, binding = 2) uniform material_t {</div>
<div class="line">  int foo;</div>
<div class="line">  vec2 bar;</div>
<div class="line">}</div>
</div><!-- fragment --><p>A sampler would also be created:</p>
<div class="fragment"><div class="line">layout(binding = 3) uniform sampler2D my_input_texture;</div>
</div><!-- fragment --><ul>
<li>Create a renderer class which inherits from <a class="el" href="classscore_1_1gfx_1_1_generic_node_renderer.html" title="Generic renderer.">score::gfx::GenericNodeRenderer</a> (to use the score conventions which simplify the most common things) or <a class="el" href="classscore_1_1gfx_1_1_node_renderer.html" title="Renderer for a given node.">score::gfx::NodeRenderer</a> (to have a complete control on resources, pipelines, etc).</li>
</ul>
<p>See <a class="el" href="structscore_1_1gfx_1_1_images_node.html" title="A node that renders an image to screen.">score::gfx::ImagesNode</a> and <a class="el" href="structscore_1_1gfx_1_1_texgen_node.html">score::gfx::TexgenNode</a> for simple examples using the "pre-made" classes, and <a class="el" href="classscore_1_1gfx_1_1_i_s_f_node.html" title="Data model for Interactive Shader Format filters.">score::gfx::ISFNode</a> or <a class="el" href="classscore_1_1gfx_1_1_video_node.html" title="Model for rendering a video.">score::gfx::VideoNode</a> for more complex example which do implement everything.</p>
<p>Once that is done, the only remaining thing is to create a score process which will allow the node to be used in the score.</p>
<h1><a class="anchor" id="ShaderConventions"></a>
Shader conventions</h1>
<p>If one inherits from the base classes <a class="el" href="classscore_1_1gfx_1_1_node.html" title="Root data model for visual nodes.">score::gfx::Node</a> and <a class="el" href="classscore_1_1gfx_1_1_node_renderer.html" title="Renderer for a given node.">score::gfx::NodeRenderer</a>, there is no restriction: shaders can have whatever UBOs, samplers, attributes, ... that the node author wishes. Of course the mesh used must be compatible with the shader attributes.</p>
<p>On the other hand, one may opt-in to the conventions of score, which allows to use the simplified score::gfx::buildPipeline and <a class="el" href="structscore_1_1gfx_1_1_default_shader_material.html" title="Utility to represent a shader material following score conventions.">score::gfx::DefaultShaderMaterial</a> utilities.</p>
<p>In that case, vertex shaders shall follow this template:</p>
<div class="fragment"><div class="line">#version 450</div>
<div class="line"> </div>
<div class="line">// Mesh input. Most common case is a full-screen quad / triangle which is</div>
<div class="line">// reflected by the 2d positions used.</div>
<div class="line">// See PhongNode for a real 3D example.</div>
<div class="line">layout(location = 0) in vec2 position;</div>
<div class="line">layout(location = 1) in vec2 texcoord;</div>
<div class="line"> </div>
<div class="line">layout(location = 0) out vec2 v_texcoord;</div>
<div class="line"> </div>
<div class="line">// Always present.</div>
<div class="line">// Corresponds to the renderer global settings:</div>
<div class="line">// - the final output size</div>
<div class="line">// - adjustment factors which depend on the graphics API used.</div>
<div class="line">layout(std140, binding = 0) uniform renderer_t {</div>
<div class="line">  mat4 clipSpaceCorrMatrix;</div>
<div class="line">  vec2 texcoordAdjust;</div>
<div class="line">  vec2 renderSize;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">// Always present.</div>
<div class="line">// Corresponds to the score process execution information.</div>
<div class="line">// Mostly taken from the ISF and ShaderToy specs.</div>
<div class="line">layout(std140, binding = 1) uniform process_t {</div>
<div class="line">  float time;</div>
<div class="line">  float timeDelta;</div>
<div class="line">  float progress;</div>
<div class="line"> </div>
<div class="line">  int passIndex;</div>
<div class="line">  int frameIndex;</div>
<div class="line"> </div>
<div class="line">  vec4 date;</div>
<div class="line">  vec4 mouse;</div>
<div class="line">  vec4 channelTime;</div>
<div class="line"> </div>
<div class="line"> float sampleRate;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">// This UBO is generated from the input ports of the score::gfx::Node</div>
<div class="line">// when using a DefaultShaderMaterial.</div>
<div class="line">layout(std140, binding = 2) uniform material_t {</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Samplers corresponding to input image ports</div>
<div class="line">// are automatically added if using a DefaultShaderMaterial, starting from binding = 3</div>
<div class="line">layout(binding = 3) uniform sampler2D first_sampler;</div>
<div class="line">layout(binding = 4) uniform sampler2D second_sampler;</div>
<div class="line"> </div>
<div class="line">out gl_PerVertex { vec4 gl_Position; };</div>
<div class="line"> </div>
<div class="line">void main()</div>
<div class="line">{</div>
<div class="line">  v_texcoord = texcoord;</div>
<div class="line">  gl_Position = clipSpaceCorrMatrix * vec4(position.xy, 0.0, 1.);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Fragment shaders shall follow this template:</p>
<div class="fragment"><div class="line">#version 450</div>
<div class="line"> </div>
<div class="line">layout(location = 0) in vec2 v_texcoord;</div>
<div class="line"> </div>
<div class="line">// &lt;!&gt; insert here all the UBOs used in the vertex shader &lt;!&gt;</div>
<div class="line">// NOTE : some APIs require the *exact* same variable names &amp; definitions to be used in</div>
<div class="line">// all the pipeline stages so be careful with it.</div>
<div class="line"> </div>
<div class="line">layout(location = 0) out vec4 fragColor;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">void main ()</div>
<div class="line">{</div>
<div class="line">  fragColor = ...;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="VideoDecoders"></a>
Video decoders</h1>
<p>If one wants to add support for GPU decoding of some video frame data, the it is sufficient to inherit from <a class="el" href="classscore_1_1gfx_1_1_g_p_u_video_decoder.html" title="Processes and renders a video frame on the GPU.">score::gfx::GPUVideoDecoder</a>.</p>
<p>The available decoders are then listed in VideoNodeRenderer::createGpuDecoder() ; the AVFormat / fourcc is used to create the correct decoder for the input format.</p>
<p>See for instance <a class="el" href="structscore_1_1gfx_1_1_y_u_v420_decoder.html" title="Decodes YUV420 videos.">score::gfx::YUV420Decoder</a> for an example of GPU decoding of tri-planar YUV420 video. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aclassfoo_html"><div class="ttname"><a href="classfoo.html">foo</a></div><div class="ttdef"><b>Definition:</b> Benchmarker.cpp:22</div></div>
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
